<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>TM ‚Äì iPhone PWA</title>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#ffffff"/>
  <!-- iOS PWA meta -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="apple-touch-icon" href="assets/icon-180.png">
  <style>
    :root { --pad: 16px; }
    html, body { margin: 0; padding: 0; font-family: -apple-system, system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif; background:#fff; color:#111; }
    header { position: sticky; top: 0; background: #fff; padding: var(--pad); border-bottom: 1px solid #eee; display:flex; justify-content:space-between; gap:8px; align-items:center; }
    h1 { font-size: 18px; margin: 0; }
    main { padding: var(--pad); }
    .row { display:flex; gap:12px; flex-wrap:wrap; align-items:flex-start; }
    .card { border:1px solid #e5e7eb; border-radius: 12px; padding: 12px; }
    #canvas { border-radius: 12px; width: 100%; height: auto; max-width: 640px; background:#f8f8f8; }
    button { padding: 10px 14px; border-radius: 10px; border:1px solid #e5e7eb; background:#fff; }
    button:active { transform: translateY(1px); }
    button:disabled { opacity: .6; }
    .controls { display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }
    .labels { min-width: 240px; }
    .status { font-size: 12px; color:#555; margin-top:6px; }
    .uploader { border:2px dashed #e5e7eb; border-radius:12px; padding:12px; text-align:center; margin-top:12px; }
    .pill { display:inline-block; padding:2px 8px; border:1px solid #e5e7eb; border-radius:9999px; font-size:12px; }
    .hint { font-size: 13px; color:#333; }
  </style>
</head>
<body>
  <header>
    <h1>Teachable Machine ‚Äì iPhone PWA</h1>
    <div>
      <button id="btn-install" hidden>Installieren</button>
      <span class="pill" id="pwaState">PWA: unbekannt</span>
    </div>
  </header>
  <main>
    <div class="row">
      <div class="card" style="max-width:700px;">
        <canvas id="canvas" width="640" height="480" aria-label="Vorschau"></canvas>
        <div class="controls">
          <button id="btn-start">üì∑ Kamera starten</button>
          <button id="btn-stop" disabled>‚èπÔ∏è Stop</button>
          <button id="btn-shot" disabled>üîç Einzel-Prediction</button>
          <label class="hint"><input type="checkbox" id="auto" checked> Live-Prediction</label>
        </div>
        <div class="uploader">
          <p style="margin:0 0 8px 0"><strong>Oder: Foto ausw√§hlen</strong></p>
          <input type="file" id="file" accept="image/*" capture="environment" style="display:none">
          <button id="btn-file">Bild aus Mediathek/Kamera w√§hlen</button>
          <div class="status">iPhone: Kamera & PWA funktionieren nur √ºber <strong>HTTPS</strong>. Tippe oben auf ‚ÄûInstallieren‚Äú, um zum Home-Bildschirm hinzuzuf√ºgen.</div>
        </div>
        <div class="status" id="status">Bereit. Tippe auf ‚ÄûKamera starten‚Äú oder w√§hle ein Bild.</div>
      </div>
      <div class="card labels">
        <strong>Ergebnis</strong>
        <div id="results"></div>
      </div>
    </div>
    <p class="status">Tipp: Lege deine Teachable‚ÄëMachine‚ÄëDateien in <code>/model</code> (<code>model.json</code>, <code>metadata.json</code>, <code>*.bin</code>). Beim ersten √ñffnen online werden alle Dateien gecacht und sind danach offline verf√ºgbar.</p>
  </main>

  <!-- TFJS & Teachable Machine (werden per SW gecached) -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.20.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
  <script src="app.js"></script>
  <script>
    // Service Worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js').catch(console.error);
      });
    }
    // PWA Install
    let deferredPrompt;
    const btnInstall = document.getElementById('btn-install');
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      btnInstall.hidden = false;
    });
    btnInstall?.addEventListener('click', async() => {
      btnInstall.hidden = true;
      if (deferredPrompt) {
        deferredPrompt.prompt();
        await deferredPrompt.userChoice;
        deferredPrompt = null;
      }
    });
    const pwaState = document.getElementById('pwaState');
    const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
    pwaState.textContent = 'PWA: ' + (isStandalone ? 'installiert' : 'nicht installiert');
  </script>
</body>
</html>
